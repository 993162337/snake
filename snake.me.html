<!--
@Author: woolson
@Date:   2017-01-17 16:01:00
@Email:  woolson.lee@gmail.com
@Last modified by:   woolson
@Last modified time: 2017-01-17 18:01:11
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Snake by Javascript</title>
  <style media="screen">
    table {
      border-collapse: collapse;
      margin: auto;
    }
    td {
      border: 1px solid #F4F4F4;
      height: 15px;
      width: 15px;
    }

    td div {
      height: 100%;
      transition: all .5s;
      border-radius: 100%;
    }

    td.snake div {
      background: #49bf49;
    }

    td.food div {
      background: #37b9ea;
    }
  </style>
  <script type="text/javascript">
    var KeyMap = {
      TOP: 38,
      RIGHT: 39,
      BOTTOM: 40,
      LEFT: 37
    }

    var Options = {
      WIDTH: 20,
      HEIGHT: 20,
      SPEED: 350,
    }

    var Medthods = function() {
      this.Snake = [[0, 0], [0, 1]]

      this.Dir = KeyMap.RIGHT

      // initial game
      this.Init = function() {
        var SELF = this
        this.DrawField()
        this.BindEvent()
        this.DrawFood()

        this.Gaming = setInterval(function() {
          SELF.Move.call(SELF)
          if(!SELF.Over) SELF.DrawSnake.call(SELF)
        }, Options.SPEED)
      }

      // draw game field
      this.DrawField = function() {
        var table = ["<table ><tbody>"]

        for(var i = 0; i < Options.WIDTH; i++) {
          table.push("<tr>")
          for(var j = 0; j < Options.HEIGHT; j++) {
            var id = "item_" + i + "_" + j
            table.push("<td id=\"" + id + "\"><div></div></td>")
          }
          table.push("</tr>")
        }
        table.push("</tbody></table>")
        document.getElementsByTagName("body")[0].innerHTML = table.join("")
      }

      this.BindEvent = function() {
        try {
            document.attachEvent("onkeydown", this.MoveSnake.bind(this));
        } catch (e) {
            document.addEventListener("keydown", this.MoveSnake.bind(this), false);
        }
      }

      // draw the snake
      this.DrawSnake = function() {
        for(var i = 0; i < this.Snake.length; i++) {
          var id = "item_" + this.Snake[i][0] + "_" + this.Snake[i][1]
          document.getElementById(id).className = "snake"
        }
      }

      this.Move = function() {
        var x = 1, y = 0

        switch (this.Dir) {
          case KeyMap.TOP:
            x = -1
            y = 0
            break
          case KeyMap.RIGHT:
            x = 0
            y = 1
            break
          case KeyMap.BOTTOM:
            x = 1
            y = 0
            break
          case KeyMap.LEFT:
            x = 0
            y = -1
            break
        }

        var id = "item_" + this.Snake[0][0] + "_" + this.Snake[0][1]
        document.getElementById(id).className = ""

        for(var i = 0; i < this.Snake.length - 1; i++) {
          this.Snake[i][0] = this.Snake[i + 1][0]
          this.Snake[i][1] = this.Snake[i + 1][1]
        }

        this.Snake[this.Snake.length - 1][0] += x
        this.Snake[this.Snake.length - 1][1] += y

        if(
          this.Snake[this.Snake.length - 1][0] > 19 ||
          this.Snake[this.Snake.length - 1][1] > 19 ||
          this.Snake[this.Snake.length - 1][0] < 0 ||
          this.Snake[this.Snake.length - 1][1] < 0
        ) {
          this.Over = true
          clearInterval(this.Gaming)
          alert("Game Over!!!")
        }
      }

      // bind key event
      this.MoveSnake = function(evt) {
        if((evt.keyCode == KeyMap.TOP && this.Dir == KeyMap.BOTTOM) ||
          (evt.keyCode == KeyMap.RIGHT && this.Dir == KeyMap.LEFT) ||
          (evt.keyCode == KeyMap.BOTTOM && this.Dir == KeyMap.TOP) ||
          (evt.keyCode == KeyMap.LEFT && this.Dir == KeyMap.RIGHT)) return

        switch(evt.keyCode) {
          case KeyMap.TOP:
            this.Dir = KeyMap.TOP
            break
          case KeyMap.RIGHT:
            this.Dir = KeyMap.RIGHT
            break
          case KeyMap.BOTTOM:
            this.Dir = KeyMap.BOTTOM
            break
          case KeyMap.LEFT:
            this.Dir = KeyMap.LEFT
            break
        }
      }

      this.Eat = function() {

      }

      // draw foods
      this.DrawFood = function() {
        var x = Math.floor(Options.WIDTH * Math.random())
        var y = Math.floor(Options.HEIGHT * Math.random())
        var id = "item_" + x + "_" + y
        document.getElementById(id).className = "food"
      }
    }

    var Game = new Medthods()

    window.onload = function() {
      Game.Init()
    }
  </script>
</head>
<body>
</body>
</html>
